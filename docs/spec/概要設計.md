# 概要設計

本書は「My Dot GEN」の機能と範囲を簡潔に示す単一の出典です。詳細なデータベース仕様や図（フロー／画面遷移）は各専門ドキュメントに分離し、ここでは参照のみを記載します。

## 概要

### アプリ名
My Dot GEN

### 目的
生成AIで自然文からドット絵を生成し、それを編集・保存・公開できるようにする。

### 技術仕様
- Typescript
- Next.js
  - AppRouterを用いること
  - ReactServerComponentを基本とし、APIよりはServerActionを使うこと。
- zod
- conform https://ja.conform.guide/
- Auth.js
- Prisma
- Tailwind CSS
- PostgreSQL

## スコープとフェーズ

- ファーストフェーズ（必須）
  - 生成（16/32/64 指定、正方形出力→縮小→ピクセル化）
  - エディタ（ペン/消し/スポイト/塗り/ズーム/グリッド/Undo-Redo）
  - 24bit カラー、パレット編集
  - 保存/読み込み（タイトル/サイズ/プロンプト/サムネ）
  - 画像コピー/PNG ダウンロード
  - 認証・本人編集制御、マイ作品一覧

- セカンドフェーズ（公開・閲覧拡張）
  - 公開スイッチ、スラッグ URL、本文（Markdown）
  - 公開ギャラリー（一覧/検索/並び替え）
  - 共有用サムネ生成
  - タグ機能［本フェーズで有効化］
    - 作品へのタグ付与/除去、入力補完
    - タグ検索（マイ作品/ギャラリー）

## 機能一覧

- 生成AI連携: OpenAI `gpt-image-1` による画像生成と縮小変換
- 入力: プロンプト、サンプル適用、生成回数/リトライ
- 変換: 正方形出力→最近傍縮小→ピクセル化→余白調整
- エディタ: 描画ツール/ズーム/グリッド/Undo-Redo/ショートカット
- 書き出し: クリップボード(PNG/Data URL)/PNGダウンロード
- 保存/読み込み: タイトル/サイズ/プロンプト/サムネを含めDB CRUD
- 認証/認可: Auth.js ログイン、本人のみ編集可能、公開可否制御
- マイ作品管理: 一覧/検索/ソート/複製
- 公開: スイッチ、スラッグ URL、本文(MD)、ギャラリー
- タグ［セカンド］: 付与/除去/補完、タグ検索（複数AND/他条件と併用）

## 画面一覧（要約）

- `/`: トップ
- `/auth/sign-in`: サインイン
- `/generate`: 生成（サイズ選択/結果プレビュー/エディタ導線）
- `/editor/:id?`: エディタ（タイトル/保存/書き出し、［セカンド］タグ編集）
- `/my/arts`: マイ作品一覧（検索/並び替え）
- `/art/:id`: 作品詳細（公開設定、［セカンド］タグ編集）
- `/gallery`［セカンド］: 公開ギャラリー（作者/タグ/サイズフィルタ、並び替え）
- `/p/:slug`［セカンド］: 公開ページ（ブログ風）
- `/*`: 404

画面遷移の詳細は `docs/spec/画面遷移図.md` を参照。

## データモデル（サマリ）

- User: `id`, `display_name`, `avatar_url`, `created_at`, `updated_at`
- PixelArt: `id`, `user_id`, `title`, `width`, `height`, `pixels`, `palette`, `prompt`, `thumb_url`, `created_at`, `updated_at`
- PublishEntry: `id`, `pixel_art_id`(一意), `slug`, `body`, `is_published`, `published_at`, `created_at`, `updated_at`
- ImageAsset: `id`, `pixel_art_id`, `kind`, `url`, `meta`, `created_at`, `updated_at`
- Tag［セカンド］: `id`, `name`, `created_at`, `updated_at`
- PixelArtTag［セカンド］: `pixel_art_id`, `tag_id`, `created_at`

詳細なER図・DDL・制約は `docs/spec/データベース定義書.md` を参照。

## タグ仕様（セカンド）

- スコープ: グローバル（全ユーザー共通）
- DB設計: `pixel_arts` と `tags` を多対多で接続（中間: `pixel_arts_tags`）
- 正規化: JavaScript で `name = input.normalize('NFKC').trim()` を適用し、長さは最大32文字（正規化後）
- ユニーク: 正規化後の `name` をユニークとする（DBでは `UNIQUE`、アプリで正規化を必須適用）

## 命名規約（DB）

- テーブル名/カラム名: スネークケース
- テーブル名: 複数形（例: `pixel_arts`, `image_assets`, `publish_entries`, `tags`, `pixel_arts_tags`）

## 非機能（抜粋）

- パフォーマンス: キャンバス描画最適化、縮小/ピクセル化はWebWorker検討
- セキュリティ: 認証必須操作の保護、公開時の最小限情報開示、APIキーはサーバ保持
- アクセシビリティ: キーボード操作、コントラスト、フォーカス管理
- 運用: 生成レート制限、失敗時リトライ、ログ/メトリクス

## 参照

- データベース定義: `docs/spec/データベース定義書.md`
- 業務フロー図: `docs/spec/フロー図.md`
- 画面遷移図: `docs/spec/画面遷移図.md`
